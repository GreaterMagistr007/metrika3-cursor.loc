<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Mini App</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: var(--tg-theme-bg-color, #ffffff);
            color: var(--tg-theme-text-color, #000000);
        }
        .container {
            max-width: 400px;
            margin: 0 auto;
            text-align: center;
        }
        .button {
            background: var(--tg-theme-button-color, #2481cc);
            color: var(--tg-theme-button-text-color, #ffffff);
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 10px;
            width: 100%;
        }
        .button:hover {
            opacity: 0.8;
        }
        .info {
            background: var(--tg-theme-secondary-bg-color, #f0f0f0);
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        .status {
            padding: 10px;
            border-radius: 5px;
            margin: 10px 0;
        }
        .success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ü§ñ Test Mini App</h1>
        
        <div class="info">
            <h3>–ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ Telegram Web App:</h3>
            <p><strong>–í–µ—Ä—Å–∏—è:</strong> <span id="version">-</span></p>
            <p><strong>–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞:</strong> <span id="platform">-</span></p>
            <p><strong>–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:</strong> <span id="user">-</span></p>
            <p><strong>Telegram ID:</strong> <span id="telegramId">-</span></p>
        </div>

        <div id="status" class="status" style="display: none;"></div>

        <button class="button" onclick="openMainApp()">
            üöÄ –û—Ç–∫—Ä—ã—Ç—å –æ—Å–Ω–æ–≤–Ω–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>

        <button class="button" onclick="getUserData()">
            üë§ –ü–æ–ª—É—á–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        </button>

        <button class="button" onclick="showAlert()">
            üí¨ –ü–æ–∫–∞–∑–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ
        </button>

        <button class="button" onclick="closeApp()">
            ‚ùå –ó–∞–∫—Ä—ã—Ç—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ
        </button>
    </div>

    <script>
        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Telegram Web App
        let tg = window.Telegram.WebApp;
        
        // –†–∞—Å—à–∏—Ä—è–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω
        tg.expand();
        
        // –í–∫–ª—é—á–∞–µ–º –∫–Ω–æ–ø–∫—É –∑–∞–∫—Ä—ã—Ç–∏—è
        tg.enableClosingConfirmation();
        
        // –ü–æ–ª—É—á–∞–µ–º –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
        const user = tg.initDataUnsafe?.user;
        
        // –ó–∞–ø–æ–ª–Ω—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
        document.getElementById('version').textContent = tg.version || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        document.getElementById('platform').textContent = tg.platform || '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        document.getElementById('user').textContent = user ? `${user.first_name} ${user.last_name || ''}`.trim() : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';
        document.getElementById('telegramId').textContent = user ? user.id : '–ù–µ–∏–∑–≤–µ—Å—Ç–Ω–æ';

        function showStatus(message, isError = false) {
            const status = document.getElementById('status');
            status.textContent = message;
            status.className = `status ${isError ? 'error' : 'success'}`;
            status.style.display = 'block';
            
            setTimeout(() => {
                status.style.display = 'none';
            }, 3000);
        }

        function openMainApp() {
            const telegramId = user ? user.id : 123456789;
            const url = `http://localhost:8000/telegram-register?telegram_id=${telegramId}`;
            
            // –û—Ç–∫—Ä—ã–≤–∞–µ–º URL –≤ —Ç–æ–º –∂–µ –æ–∫–Ω–µ
            window.location.href = url;
        }

        function getUserData() {
            if (user) {
                const userInfo = `
–ò–º—è: ${user.first_name} ${user.last_name || ''}
Username: @${user.username || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
ID: ${user.id}
–Ø–∑—ã–∫: ${user.language_code || '–Ω–µ —É–∫–∞–∑–∞–Ω'}
                `;
                showStatus(`–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:\n${userInfo}`);
            } else {
                showStatus('–î–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –Ω–µ–¥–æ—Å—Ç—É–ø–Ω—ã', true);
            }
        }

        function showAlert() {
            tg.showAlert('–≠—Ç–æ —Ç–µ—Å—Ç–æ–≤–æ–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–µ –∏–∑ Mini App!');
        }

        function closeApp() {
            tg.close();
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ —Å–æ–±—ã—Ç–∏–π
        tg.onEvent('mainButtonClicked', () => {
            showStatus('–ù–∞–∂–∞—Ç–∞ –≥–ª–∞–≤–Ω–∞—è –∫–Ω–æ–ø–∫–∞!');
        });

        tg.onEvent('backButtonClicked', () => {
            showStatus('–ù–∞–∂–∞—Ç–∞ –∫–Ω–æ–ø–∫–∞ –Ω–∞–∑–∞–¥!');
        });

        // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º —Å—Ç–∞—Ç—É—Å –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        showStatus('Mini App –∑–∞–≥—Ä—É–∂–µ–Ω —É—Å–ø–µ—à–Ω–æ!');
    </script>
</body>
</html>
